<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Nodejs | Daisy</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="本文主要是一个nodejs的学习笔记。">
<meta name="keywords" content="javascript,Node">
<meta property="og:type" content="article">
<meta property="og:title" content="Nodejs">
<meta property="og:url" content="http://daisygxl.github.io/2017/09/25/nodejs/index.html">
<meta property="og:site_name" content="Daisy">
<meta property="og:description" content="本文主要是一个nodejs的学习笔记。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-01-04T03:21:06.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Nodejs">
<meta name="twitter:description" content="本文主要是一个nodejs的学习笔记。">
  
    <link rel="alternate" href="/atom.xml" title="Daisy" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Daisy</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://daisygxl.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-nodejs" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/09/25/nodejs/" class="article-date">
  <time datetime="2017-09-24T16:00:00.000Z" itemprop="datePublished">2017-09-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Node/">Node</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Nodejs
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>本文主要是一个nodejs的学习笔记。</p>
<a id="more"></a>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>NodeJs 可以解析Js代码（没有浏览器安全级别的限制）<br>提供系统级别的API：</p>
<ul>
<li>文件的读写</li>
<li>进程管理</li>
<li>网络通信</li>
</ul>
<p>Node.js的版本：</p>
<ul>
<li>偶数位为稳定版本（0.6.x 0.8.x)</li>
<li>奇数为非稳定版本 (0.5.x 0.7.x)</li>
</ul>
<h1 id="在Mac环境下搭建一个简单的web服务器"><a href="#在Mac环境下搭建一个简单的web服务器" class="headerlink" title="在Mac环境下搭建一个简单的web服务器"></a>在Mac环境下搭建一个简单的web服务器</h1><p>前提：</p>
<ul>
<li>安装xcode <code>xcode-select –install</code></li>
<li>检查是否已经安装 Python</li>
<li>安装 Homebrew</li>
<li>安装 Node</li>
<li>创建 Demo 目录</li>
</ul>
<p>在以上步骤都准备好后，可以开始搭建我们最简单的Web服务器了，新建文件server.js，粘贴下面代码。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</div><div class="line">http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</div><div class="line">    res.writeHead(<span class="number">200</span>,&#123;<span class="string">'Content-Type'</span>:<span class="string">'text/plain'</span>&#125;);</div><div class="line">    res.end(<span class="string">'Hello World\n'</span>);</div><div class="line">&#125;).listen(<span class="number">1337</span>,<span class="string">'127.0.0.1'</span>);</div><div class="line"><span class="built_in">console</span>.log(<span class="string">'Server running at http://127.0.0.1:1337/'</span>);</div></pre></td></tr></table></figure></p>
<p>然后，在server.js目录下运行命令，即可启动Web服务器。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">node serve.js</div></pre></td></tr></table></figure></p>
<p>这样，就可以通过访问127.0.0.1:1337访问到我们的Hello World页面了。</p>
<h1 id="模块与包管理工具"><a href="#模块与包管理工具" class="headerlink" title="模块与包管理工具"></a>模块与包管理工具</h1><p><strong>js的天生缺陷——缺少模块化管理机制</strong><br>·表现</p>
<blockquote>
<p>JS中容易出现变量被覆盖，方法被替代的情况（既被污染）。特别是存在依赖关系时，容易出现错误。这是因为JS缺少模块管理机制，来隔离实现各种不同功能的JS判断，避免它们相互污染。</p>
</blockquote>
<p>·解决</p>
<blockquote>
<p>经常采用命名空间的方式，把变量和函数限制在某个特定的作用域内，人肉约定一套命名规范来限制代码，保证代码安全运行。jQuery中有许多变量和方法，但是无法直接访问，必须通过jQuery，$调用各个方法。</p>
</blockquote>
<p><strong>Commonjs规范</strong><br>不同于jQuery，Commonjs是一套规范，约定了js如何组织，如何编写，包括包，二进制，套接字，单元测试等等。大部分标准在拟定和讨论之中，首先把执行不同任务的代码块和代码文件看为独立的模块，每一个模块都是一个单独的作用域，但不是孤立的，可能存在依赖关系。每个模块分为三个部分，定义、标识和引用。这套规范与现实产品如node.js相互影响，良性循环。</p>
<p><strong>NodeJs的模块管理机制</strong><br>基于commonjs实现了模块管理系统。node中每一个js文件都是一个独立的模块，在其内部不需要有命名空间，不需要担心变量的污染和方法定义时的隔离。同时模块之间可以组合形成更强大的模块或功能包。npm即是用来管理各种功能包的。</p>
<p><strong>模块的分类</strong></p>
<ul>
<li>模块的分类: 核心模块、文件模块、第三方模块；</li>
<li>模块的引用：可以通过路径和模块名。模块名引用最终也会被映射为路径。包含了核心函数的核心模块会在node启动时被预先加载。</li>
<li>文件模块、第三方模块 都是非核心模块，文件模块就是本地模块。</li>
</ul>
<p><strong>创建一个最简单的nodejs模块</strong><br>1.创建student.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">student</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"Add student:"</span> + student);</div><div class="line">&#125;</div><div class="line"></div><div class="line">exports.add = add;</div></pre></td></tr></table></figure></p>
<p>2.创建tescher.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">teacher</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"Add teache:"</span> + teacher);</div><div class="line">&#125;</div><div class="line"></div><div class="line">exports.add = add;</div></pre></td></tr></table></figure></p>
<p>3.创建klass.js，引入上面两个模块<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> student = <span class="built_in">require</span>(<span class="string">'./student'</span>);</div><div class="line"><span class="keyword">var</span> teacher= <span class="built_in">require</span>(<span class="string">'./teacher'</span>);</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span> (<span class="params">teacherName, students</span>) </span>&#123;</div><div class="line">    teacher.add(teacherName);</div><div class="line">    students.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">item, index</span>) </span>&#123;</div><div class="line">        student.add(item);</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">exports.add = add;</div></pre></td></tr></table></figure></p>
<p>4.创建index.js，调用klass模块<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> klass = <span class="built_in">require</span>(<span class="string">'./klass'</span>);</div><div class="line"></div><div class="line">klass.add(<span class="string">'Lily'</span>, [<span class="string">'hoho'</span>, <span class="string">'xixi'</span>]);</div></pre></td></tr></table></figure></p>
<p>最终，在命令行中执行<code>node index.js</code>，输出结果如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">➜  school node index.js</div><div class="line">Add teache:Lily</div><div class="line">Add student:hoho</div><div class="line">Add student:xixi</div></pre></td></tr></table></figure></p>
<h1 id="Node的API"><a href="#Node的API" class="headerlink" title="Node的API"></a>Node的API</h1><h2 id="URL网址解析"><a href="#URL网址解析" class="headerlink" title="URL网址解析"></a>URL网址解析</h2><p><strong>url解析</strong><br><code>url.parse(urlString, 是否把query转为对象, 是否识别未知协议的url);</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&gt; url</div><div class="line">&#123; Url: [Function: Url],</div><div class="line">  parse: [Function: urlParse],</div><div class="line">  resolve: [Function: urlResolve],</div><div class="line">  resolveObject: [Function: urlResolveObject],</div><div class="line">  format: [Function: urlFormat],</div><div class="line">  URL: [Function: URL],</div><div class="line">  URLSearchParams: [Function: URLSearchParams],</div><div class="line">  domainToASCII: [Function: domainToASCII],</div><div class="line">  domainToUnicode: [Function: domainToUnicode] &#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&gt; url.parse(&apos;http://www.imooc.com/video/6710?form=scott#loor1&apos;)</div><div class="line">Url &#123;</div><div class="line">  protocol: &apos;http:&apos;,</div><div class="line">  slashes: true,</div><div class="line">  auth: null,</div><div class="line">  host: &apos;www.imooc.com&apos;,</div><div class="line">  port: null,</div><div class="line">  hostname: &apos;www.imooc.com&apos;,</div><div class="line">  hash: &apos;#loor1&apos;,</div><div class="line">  search: &apos;?form=scott&apos;,</div><div class="line">  query: &apos;form=scott&apos;,</div><div class="line">  pathname: &apos;/video/6710&apos;,</div><div class="line">  path: &apos;/video/6710?form=scott&apos;,</div><div class="line">  href: &apos;http://www.imooc.com/video/6710?form=scott#loor1&apos; &#125;</div></pre></td></tr></table></figure>
<p><strong>url格式化</strong><br><code>url.format({})</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&gt; url.format(&#123;</div><div class="line">...   protocol: &apos;http:&apos;,</div><div class="line">...   slashes: true,</div><div class="line">...   auth: null,</div><div class="line">...   host: &apos;www.imooc.com&apos;,</div><div class="line">...   port: null,</div><div class="line">...   hostname: &apos;www.imooc.com&apos;,</div><div class="line">...   hash: &apos;#loor1&apos;,</div><div class="line">...   search: &apos;?form=scott&apos;,</div><div class="line">...   query: &apos;form=scott&apos;,</div><div class="line">...   pathname: &apos;/video/6710&apos;,</div><div class="line">...   path: &apos;/video/6710?form=scott&apos;,</div><div class="line">...   href: &apos;http://www.imooc.com/video/6710?form=scott#loor1&apos; &#125;)</div><div class="line">&apos;http://www.imooc.com/video/6710?form=scott#loor1&apos;</div></pre></td></tr></table></figure></p>
<p><strong>url拼接</strong><br><code>url.resolve(str1, str2)</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; url.resolve(&apos;http://immoc.com/&apos;, &apos;/course/list&apos;)</div><div class="line">&apos;http://immoc.com/course/list&apos;</div></pre></td></tr></table></figure></p>
<h2 id="querystring参数解析"><a href="#querystring参数解析" class="headerlink" title="querystring参数解析"></a>querystring参数解析</h2><p><strong>参数序列化</strong><br><code>querystring.stringify({}, 参数之间的连接符-默认为&amp;, key和value之间的符号-默认=)</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; querystring.stringify(&#123;name:&apos;scott&apos;, course:[&apos;jade&apos;,&apos;node&apos;], from: &apos;&apos;&#125;)</div><div class="line">&apos;name=scott&amp;course=jade&amp;course=node&amp;from=&apos;</div><div class="line"></div><div class="line">&gt; querystring.stringify(&#123;name:&apos;scott&apos;, course:[&apos;jade&apos;,&apos;node&apos;], from: &apos;&apos;&#125;, &apos;,&apos;)</div><div class="line">&apos;name=scott,course=jade,course=node,from=&apos;</div><div class="line"></div><div class="line">&gt; querystring.stringify(&#123;name:&apos;scott&apos;, course:[&apos;jade&apos;,&apos;node&apos;], from: &apos;&apos;&#125;, &apos;,&apos;,&apos;:&apos;)</div><div class="line">&apos;name:scott,course:jade,course:node,from:&apos;</div></pre></td></tr></table></figure></p>
<p><strong>参数反序列化</strong><br><code>querystring.parse(‘’, 参数之间的连接符-默认为&amp;, key和value之间的符号-默认=)</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; querystring.parse(&apos;name=scott&amp;course=jade&amp;course=node&amp;from=&apos;)</div><div class="line">&#123; name: &apos;scott&apos;, course: [ &apos;jade&apos;, &apos;node&apos; ], from: &apos;&apos; &#125;</div></pre></td></tr></table></figure></p>
<p><strong>转义</strong><br><code>querystring.escape(str)</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; querystring.escape(&apos;&lt;哈哈&gt;&apos;)</div><div class="line">&apos;%3C%E5%93%88%E5%93%88%3E&apos;</div></pre></td></tr></table></figure></p>
<p> <strong>反转义</strong><br> <code>querystring.unescape</code><br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"> &gt; querystring.unescape(&apos;%3C%E5%93%88%E5%93%88%3E&apos;)</div><div class="line">&apos;&lt;哈哈&gt;&apos;</div></pre></td></tr></table></figure></p>
<h2 id="Http"><a href="#Http" class="headerlink" title="Http"></a>Http</h2><p>1.http客户端发起请求，创建端口<br>2.http服务器在端口监听客户端的请求<br>3.http服务器向客户端返回状态和内容</p>
<p><strong>浏览器发起请求到步骤</strong><br>1.Chrome搜索自身的DNS缓存<br>2.搜索操作系统的DNS缓存<br>3.读取本地的Host文件<br>4.浏览器发起一个DNS一个系统调用（向运营商发起，下面小节步骤）<br>5.浏览器获得域名对应的IP地址后，发起HTTP的三次握手<br>6.TCP/IP连接建立起来后，浏览器就可以向服务器发送HTTP请求了<br>7.服务器端接受到这个请求，根据路径参数，经过后端处理后，把处理后的一个结果的数据返回给浏览器<br>8.浏览器获取到目标网址的数据，例如返回一个HTML文件,HTML文档内的JS/CSS/图片静态资源同样也是一个个HTTP请求，也要包括上述步骤<br>9.浏览器根据获取到的资源对页面进行渲染，最终把网页呈献给用户</p>
<p><strong>运营商的DNS服务器</strong><br>1.宽带运营商服务器查看本身缓存<br>2.运营商服务器代替浏览器发起一个迭代的DNS解析请求，运营商服务器把结果返回给操作系统内核同时缓存起来，操作系统内核把结果返回给浏览器</p>
<p><strong>http头和正文信息</strong><br>HTTP头发送的是一些附加的信息：内容类型、服务器发送相应的日期、HTTP状态码。<br>正文就是用户提交的表单数据。</p>
<p>1、什么是回调函数？<br>回调是异步编程时的基础，将后续逻辑封装成起始函数的参数，逐层嵌套<br>2、什么事同步/异步？<br>同步：发送方发送数据后，等待接收方发回响应以后才发下一个数据包的通讯方式<br>异步：发送方发出数据后，不等接收方发回响应，接着发送下个数据包的通讯方式<br>3、什么事I/O?<br>文件系统里面 磁盘的写入（in）磁盘的读取（out）<br>4、什么是单线程/多线程？<br>一次只能执行一个程序叫做单线程<br>一次能执行多个程序叫做多线程<br>5、什么是阻塞/非阻塞？<br>阻塞：前一个程序未执行完就得一直等待<br>非阻塞：前一个程序未执行完时可以挂起，继续执行其他程序，等到使用时再执行<br>6、什么是事件？<br>一个触发动作（例如点击按钮）<br>7、什么是事件驱动？<br>一个触发动作引起的操作（例如点击按钮后弹出一个对话框）<br>8、什么是基于事件驱动的回调？<br>为了某个事件注册了回调函数，但是这个回调函数不是马上执行，只有当事件发生的时候，才会调用回掉函数，这种函数执行的方式叫做事件驱动~这种注册回掉就是基于事件驱动的回调，如果这些回调和异步I/O（数据写入、读取）操作相关，可以看作是基于回调的异步I/O。只不过这种回调在nodejs中是由事件来驱动的<br>9、什么是事件循环？<br>事件循环Eventloop，倘若有大量的异步操作，如一些I/O的耗时操作，甚至是一些定时器控制的延时操作，它们完成的时候都要调用相应的回调函数，而从完成一些密集的任务，而又不会阻塞整个程序执行的流程，此时需要一种机制来管理，这种机制叫做事件循环<br>总而言之，管理大量异步操作的机制叫做事件循环</p>
<p><strong>作用域和上下文</strong><br>作用域：与调用函数,访问变量的能力有关 作用域分为：局部和全局（在局部作用域里可以访问到全局作用域的变量，但在局部作用域外面就访问不到局部作用里面所设定的变量）</p>
<p>上下文：与this关键字有关 是调用当前可执行代码的引用<br>       this总是指向调用这个的方法的对象<br>js里的this 通常是当前函数的拥有者<br>this 是js的一个关键字 代表函数运行时自动生成的一个内部对象 只能在函数内部使用</p>
<p>1.作为对象的方法<br>this在方法内部，this就指向调用这个方法的对象<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> pet =  &#123;</div><div class="line">    words: <span class="string">'...'</span>,</div><div class="line">    speak: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.words);</div><div class="line">        <span class="built_in">console</span>.log(pet===<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">pet.speak();</div></pre></td></tr></table></figure></p>
<p>2.函数的调用<br>this指向执行环境中的全局对象（浏览器-&gt;window  nodejs-&gt;global）<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">pets</span>(<span class="params">words</span>) </span>&#123;</div><div class="line">    <span class="keyword">this</span>.words = words;</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.words);</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>);</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>===global);</div><div class="line">&#125;</div><div class="line"></div><div class="line">pets(<span class="string">'...'</span>);</div></pre></td></tr></table></figure></p>
<p>3.构造函数<br>this所在的方法被实例对象所调用，那么this就指向这个实例对象<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">petss</span>(<span class="params">words</span>) </span>&#123;</div><div class="line">    <span class="keyword">this</span>.words = words;</div><div class="line">    <span class="keyword">this</span>.speak = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.words);</div><div class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> cat = <span class="keyword">new</span> petss(<span class="string">'miao'</span>);</div><div class="line">cat.speak();</div></pre></td></tr></table></figure></p>
<p>更改上下文方法(更改this指向的内容,可方便地实现继承)：</p>
<ul>
<li><p>call(list);</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> pet = &#123;</div><div class="line">    words: <span class="string">'...'</span>,</div><div class="line">    speak: <span class="function"><span class="keyword">function</span>(<span class="params">say</span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(say + <span class="string">' '</span> + <span class="keyword">this</span>.words);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> dog = &#123;</div><div class="line">    words: <span class="string">'wang'</span></div><div class="line">&#125;</div><div class="line"><span class="comment">//通过使用call方法，将pet的上下文指向为dog内部</span></div><div class="line">pet.speak.call(dog, <span class="string">'Speak'</span>);</div></pre></td></tr></table></figure>
</li>
<li><p>apply(array);<br>根据call()、apply()改变上下文this指向的特性,也可以方便实现继承。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Pet</span>(<span class="params">words</span>) </span>&#123;</div><div class="line">    <span class="keyword">this</span>.words = words;</div><div class="line">    <span class="keyword">this</span>.speak = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.words);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Dog</span>(<span class="params">words</span>) </span>&#123;</div><div class="line">    Pet.call(<span class="keyword">this</span>, words);</div><div class="line">    <span class="comment">//Pet.apply(this. arguments);</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> dog = <span class="keyword">new</span> Dog(<span class="string">'wang'</span>);</div><div class="line">dog.speak();</div></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>事件Events</strong><br>a.EventEmitter支持多个事件监听，最大为10，也可以自定义最大数<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//添加监听</span></div><div class="line"><span class="keyword">var</span> EventEmitter = <span class="built_in">require</span>(<span class="string">'events'</span>).EventEmitter;</div><div class="line"><span class="keyword">var</span> instance = <span class="keyword">new</span> EventEmitter();</div><div class="line">instance.on(<span class="string">'event'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">arguments</span>)</span>&#123;&#125;);</div></pre></td></tr></table></figure></p>
<p>b.如果超过十个也能执行，不过有可能会造成内存泄漏<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//自定义最大数</span></div><div class="line"><span class="comment">//每个setMaxListeners针对的是一个特定事件：即event1,event2,... 默认最大都为10,本例为num</span></div><div class="line">instance.setMaxListeners(num);</div></pre></td></tr></table></figure></p>
<pre><code>c.事件监听之后，需要emit(发射,发出)才会执行
</code></pre><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">instance.emit(<span class="string">'event'</span>,<span class="built_in">arguments</span>)</div></pre></td></tr></table></figure>
<p>d.判断是否监听<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> a = instance.emit(<span class="string">'event'</span>,<span class="built_in">arguments</span>)	</div><div class="line"><span class="built_in">console</span>.log(a)   <span class="comment">//打印出来的是布尔值true or false</span></div></pre></td></tr></table></figure></p>
<p>e.移除监听事件<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//移除单个事件监听</span></div><div class="line">instance.removeListener(<span class="string">'event'</span>,funcName)	<span class="comment">//移除事件需具名函数，匿名函数不行</span></div><div class="line"></div><div class="line"><span class="comment">//移除多个事件监听</span></div><div class="line">instance.removeAllListerner()	<span class="comment">//不传参表示移除所有事件监听</span></div><div class="line">instance.removeAllListerner(<span class="string">'event'</span>)	<span class="comment">//移除特定event的所有事件监听</span></div></pre></td></tr></table></figure></p>
<p>f.计算事件监听数量<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//第一种</span></div><div class="line">instance.listeners(<span class="string">'event'</span>).length</div><div class="line"></div><div class="line"><span class="comment">//第二种</span></div><div class="line">EventEmitter.listenerCount(instance,<span class="string">'event'</span>)</div></pre></td></tr></table></figure></p>
<p><strong>Http请求的性能测试</strong><br>1.如果没有安装Apache的话，首先要安装Apache。<br>2.mac直接在终端命令行中运行命令 <code>ab -n1000 -c10 <a href="http://localhost:2017/" target="_blank" rel="external">http://localhost:2017/</a></code> 即测试本地服务的性能。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</div><div class="line"></div><div class="line">http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</div><div class="line">    res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>&#125;);</div><div class="line">    res.write(<span class="string">'Hello nodejs'</span>);</div><div class="line">    res.end();</div><div class="line">&#125;).listen(<span class="number">2017</span>)</div></pre></td></tr></table></figure></p>
<p>3.ab -n1000 -c10 url   即测试任意url的性能<br>-n1000 总请求数1000 默认值1<br>-c10 并发数10  默认值1<br>-t 测试的时间<br>-p post数据文件</p>
<p>##小实践<br><strong>http小爬虫</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</div><div class="line"><span class="keyword">var</span> url = <span class="string">'http://www.imooc.com/learn/901'</span>;</div><div class="line"><span class="keyword">var</span> cheerio = <span class="built_in">require</span>(<span class="string">'cheerio'</span>);</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">filterChapters</span>(<span class="params">html</span>)</span>&#123;</div><div class="line">	<span class="keyword">var</span> $ = cheerio.load(html);</div><div class="line">    <span class="keyword">var</span> chapters = $(<span class="string">'.learnChapter'</span>);</div><div class="line">    <span class="keyword">var</span> courseData = [];</div><div class="line">	chapters.each(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>)</span>&#123;</div><div class="line">		<span class="keyword">var</span> chapter = $(<span class="keyword">this</span>);</div><div class="line">		<span class="keyword">var</span> chapterTitle = chapter.find(<span class="string">'strong'</span>).text();</div><div class="line">		<span class="keyword">var</span> videos = chapter.find(<span class="string">'.video'</span>).children(<span class="string">'li'</span>);</div><div class="line">		<span class="keyword">var</span> chapterData = &#123;</div><div class="line">			chapterTitle: chapterTitle,</div><div class="line">			videos: []</div><div class="line">		&#125;</div><div class="line">        videos.each(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>)</span>&#123;</div><div class="line">			<span class="keyword">var</span> video = $(<span class="keyword">this</span>).find(<span class="string">'.studyvedio'</span>);</div><div class="line">			<span class="keyword">var</span> videoTitle = video.text();</div><div class="line">			<span class="keyword">var</span> id = video.attr(<span class="string">'href'</span>).split(<span class="string">'video/'</span>)[<span class="number">1</span>];</div><div class="line">			chapterData.videos.push(&#123;<span class="attr">title</span>: videoTitle,<span class="attr">id</span>: id&#125;);</div><div class="line">		&#125;);</div><div class="line">		courseData.push(chapterData);</div><div class="line">	&#125;);</div><div class="line">	<span class="keyword">return</span> courseData;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">printCourseInfo</span>(<span class="params">courseData</span>)</span>&#123;</div><div class="line">	courseData.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>)</span>&#123;</div><div class="line">		<span class="keyword">var</span> chapterTitle = item.chapterTitle;</div><div class="line">		<span class="built_in">console</span>.log(chapterTitle + <span class="string">'\n'</span>);</div><div class="line">		item.videos.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">video</span>)</span>&#123;</div><div class="line">			<span class="built_in">console</span>.log(<span class="string">'['</span> + video.id + <span class="string">']'</span> + video.title + <span class="string">'\n'</span>);</div><div class="line">		&#125;);</div><div class="line">	&#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>评论灌水</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> http =<span class="built_in">require</span>(<span class="string">'http'</span>);</div><div class="line"><span class="keyword">var</span> querystring =<span class="built_in">require</span>(<span class="string">'querystring'</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> postData = querystring.stringify(&#123;</div><div class="line">	<span class="string">'content'</span>:<span class="string">'小路人注水测试评论'</span>,</div><div class="line">	<span class="string">'mid'</span>:<span class="number">8837</span></div><div class="line">&#125;);</div><div class="line"><span class="keyword">var</span> options=&#123;</div><div class="line">	hostname : <span class="string">'www.imooc.com'</span>,</div><div class="line">	port:<span class="number">80</span>,</div><div class="line">	path:<span class="string">'/course/docomment'</span>,</div><div class="line">	method:<span class="string">'POST'</span>,</div><div class="line">	headers:&#123;消息头&#125;);</div><div class="line"><span class="keyword">var</span> req=http.request(options ,<span class="function"><span class="keyword">function</span> (<span class="params">res</span>)</span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'Status: '</span>+res.statusCode);</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'headers: '</span>+<span class="built_in">JSON</span>.stringify(res.headers));</div><div class="line">	res.on(<span class="string">'data'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">chunk</span>)</span>&#123;</div><div class="line">		<span class="built_in">console</span>.log(Buffer.isBuffer(chunk));</div><div class="line">		<span class="built_in">console</span>.log(<span class="keyword">typeof</span> chunk);</div><div class="line">	&#125;);</div><div class="line">	res.on(<span class="string">'end'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">		<span class="built_in">console</span>.log(<span class="string">'小路人注水评论完毕！'</span>);</div><div class="line">	&#125;);</div><div class="line">&#125;);</div><div class="line">req.on(<span class="string">'error'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'Error: '</span>+e.message);</div><div class="line">&#125;);</div><div class="line">req.write(postData);</div><div class="line">req.end();</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://daisygxl.github.io/2017/09/25/nodejs/" data-id="cjc002nwd000i079cbr44031u" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Node/">Node</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/11/02/angular4/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Angular4
        
      </div>
    </a>
  
  
    <a href="/2017/09/18/boostrap/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Bootstrap</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/ES6/">ES6</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Node/">Node</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/angular/">angular</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/boostrap/">boostrap</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/node/">node</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/web-mobile/">web mobile</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ES6/">ES6</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Node/">Node</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/angular/">angular</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blog/">blog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bootstrap/">bootstrap</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/">github</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mobile/">mobile</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mocha/">mocha</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node/">node</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/supertest/">supertest</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web/">web</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/单元测试/">单元测试</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/电子书/">电子书</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/ES6/" style="font-size: 10px;">ES6</a> <a href="/tags/Node/" style="font-size: 10px;">Node</a> <a href="/tags/angular/" style="font-size: 10px;">angular</a> <a href="/tags/blog/" style="font-size: 15px;">blog</a> <a href="/tags/bootstrap/" style="font-size: 10px;">bootstrap</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/github/" style="font-size: 10px;">github</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/javascript/" style="font-size: 20px;">javascript</a> <a href="/tags/mobile/" style="font-size: 10px;">mobile</a> <a href="/tags/mocha/" style="font-size: 10px;">mocha</a> <a href="/tags/node/" style="font-size: 10px;">node</a> <a href="/tags/supertest/" style="font-size: 10px;">supertest</a> <a href="/tags/web/" style="font-size: 10px;">web</a> <a href="/tags/单元测试/" style="font-size: 10px;">单元测试</a> <a href="/tags/电子书/" style="font-size: 10px;">电子书</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/12/25/mobile/">移动端页面开发手记（一）</a>
          </li>
        
          <li>
            <a href="/2017/11/02/angular4/">Angular4</a>
          </li>
        
          <li>
            <a href="/2017/09/25/nodejs/">Nodejs</a>
          </li>
        
          <li>
            <a href="/2017/09/18/boostrap/">Bootstrap</a>
          </li>
        
          <li>
            <a href="/2017/09/14/gitbook/">git-pages</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 Daisy<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>